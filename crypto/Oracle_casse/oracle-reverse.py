'''
$ nc challenges.404ctf.fr 31674
Bienvenue dans notre nouveau service d'oracle!
Le service de l'année précédente nous a causé de nombreaux problèmes, il ne fonctionnait pas comme attendu et était inefficace.
C'est pourquoi nous avons décidé de tout reprendre à zéro! Cette fois un seul oracle est présent, et il a été optimisé pour être le plus efficace possible!
Pour fêter le lancement de ce nouveau service, nous offrons un cadeau aux mille premiers utilisateurs.
...........................................................................................................................................................
Félicitations! Vous faîtes parti des mille premiers! Voici votre bon-cadeau à utiliser dans l'oracle!:
19954536137413049069725718632123144876938322782619680025138760809743495713774446207599950812214925688838997564709564783874636462771109910828227532928174946396436076056918137882599342425488189697565682358447872011141574458576698323687234927675062102869280613805755040835958128735008189935094221432445596510906003637991674938536551749230332118770696614695221247111685317395224057030148152399448834011029615507535803650928452682971341488508630023397534467553806440954006621846770602307061783799843460348520792472644136850167742989439963135091580862087127928831789352235009034446517642590812669379790193107164799607142199
Initialisation de l'oracle n°0xc26c5658fe724e724f128b4a374bb1f99f50861c959d12b400a7bfc95e850c1c332e85ae2b45c2aaca7751ab59bc77ae3de6f5f1dfe2e2c7ca3148ed7030c9837b4088b450614160adffa388d863b5c15f1c873cca8b173152b370eea30e71f75b8bcd8a19729bb80850dc01d8f42b9d5c7343120924690de73b61251d31a53a3a16e011d4e3eb15c5b5d5a3553f89ed3a4d6d0c13d19c3a741dfb12b77b257b98f6d5c1d36315a04df63324cb57373c9638f7cc9e16e4299a64de5c11a50d6c19b12802a27dafbea5f8d46c46bcd8b2fc621fda6a693347c52edea16d191f7b7277865df14c2f5cd3046d700b03328df55ffce435069b4cd68a56c702cec91f terminée. Bonne utilisation!
Que voulez vous envoyer à l'oracle?
19954536137413049069725718632123144876938322782619680025138760809743495713774446207599950812214925688838997564709564783874636462771109910828227532928174946396436076056918137882599342425488189697565682358447872011141574458576698323687234927675062102869280613805755040835958128735008189935094221432445596510906003637991674938536551749230332118770696614695221247111685317395224057030148152399448834011029615507535803650928452682971341488508630023397534467553806440954006621846770602307061783799843460348520792472644136850167742989439963135091580862087127928831789352235009034446517642590812669379790193107164799607142199
17144131568611544923924884117149141141948607698871432583524322994388188895817862747946817335233528390478646775940133631708639280395207181507389357229038329877161519985389549570992309434991988223802462946696478593821096221012801154569192196406096811043575701914549932051487719576485351105921305787858713752637215902619522029326167376082406665962547715920097288752959585296389895068599477674951519077862202378532752064805649845769039000216361672920963485602232065196309327645211835813295389700317869926869231025160249503972392564694904334791072796301810377270443089294098961958239656638432529486157922526655559022979795
Que voulez vous envoyer à l'oracle?
'''

from Crypto.Util.number import long_to_bytes
from math import gcd

ct = encrypted_GIFT = 19954536137413049069725718632123144876938322782619680025138760809743495713774446207599950812214925688838997564709564783874636462771109910828227532928174946396436076056918137882599342425488189697565682358447872011141574458576698323687234927675062102869280613805755040835958128735008189935094221432445596510906003637991674938536551749230332118770696614695221247111685317395224057030148152399448834011029615507535803650928452682971341488508630023397534467553806440954006621846770602307061783799843460348520792472644136850167742989439963135091580862087127928831789352235009034446517642590812669379790193107164799607142199
n = 0xc26c5658fe724e724f128b4a374bb1f99f50861c959d12b400a7bfc95e850c1c332e85ae2b45c2aaca7751ab59bc77ae3de6f5f1dfe2e2c7ca3148ed7030c9837b4088b450614160adffa388d863b5c15f1c873cca8b173152b370eea30e71f75b8bcd8a19729bb80850dc01d8f42b9d5c7343120924690de73b61251d31a53a3a16e011d4e3eb15c5b5d5a3553f89ed3a4d6d0c13d19c3a741dfb12b77b257b98f6d5c1d36315a04df63324cb57373c9638f7cc9e16e4299a64de5c11a50d6c19b12802a27dafbea5f8d46c46bcd8b2fc621fda6a693347c52edea16d191f7b7277865df14c2f5cd3046d700b03328df55ffce435069b4cd68a56c702cec91f
e = 0x10001

s = first_decrypted_GIFT = 17144131568611544923924884117149141141948607698871432583524322994388188895817862747946817335233528390478646775940133631708639280395207181507389357229038329877161519985389549570992309434991988223802462946696478593821096221012801154569192196406096811043575701914549932051487719576485351105921305787858713752637215902619522029326167376082406665962547715920097288752959585296389895068599477674951519077862202378532752064805649845769039000216361672920963485602232065196309327645211835813295389700317869926869231025160249503972392564694904334791072796301810377270443089294098961958239656638432529486157922526655559022979795

# si l'oracle fonctionne correctement, on doit avoir GIFT = oracle(ct) directement.
print(f'1er GIFT candidat : {long_to_bytes(first_decrypted_GIFT)}')

# On devrait aussi avoir : ct = s**e modulo n
delta = ct - pow(s, e, n)
if not delta:
    print(f'on a bien trouvé le flag !!')
else:
    p = gcd(n, delta)
    q = n // p
    phi = (p - 1) * (q - 1)
    d = pow(e, -1, phi)
    reverse_ct = second_decrypted_GIFT = pow(ct, d, n)
    print(f'---------------------------')
    print(f'2eme GIFT candidat : {long_to_bytes(second_decrypted_GIFT)}')
